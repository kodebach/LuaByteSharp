<h1 id="luabytesharp">LuaByteSharp</h1>
<h2 id="kurzbeschreibung-des-projekts">Kurzbeschreibung des Projekts</h2>
<p>LuaByteSharp soll ein Interpreter für Lua Byte-Code werden. Der Interpreter soll in C# geschrieben werden.<br />
Das Programm soll fähig sein, den vom Lua Standardcompiler luac, in der Version 5.3, erzeugten Byte-Code einzulesen und auszuführen.<br />
Geplant ist, dass alle der 47 existierenden Operationen (<a href="https://www.lua.org/source/5.3/lopcodes.h.html">siehe</a>) unterstützt werden.<br />
Als Quellen für die Beschreibung der Opertationen, sowie des generellen Formats eines LuaByteCode Files, werden die unter <a href="#Quellen">Quellen</a> gelisteten Quellen verwendet.</p>
<p>Geplant ist ebenfalls, dass das Metatable-Konzept (<a href="https://www.lua.org/manual/5.3/manual.html#2.4">siehe</a>) von Lua unterstützt wird.</p>
<p>Da Lua-Code oft auf der Lua Standard Library aufbaut, soll zumindest ein Subset der Standard Library unterstützt werden.<br />
Das Subset wird wahrscheinlich je nach verfügbarer Zeit angepasst werden. Jedenfalls werden aber weder <code>require</code> noch <code>load</code> bzw. <code>loadfile</code> und infolgedessen auch nicht <code>dofile</code> untersützt werden, da alle diese Funktionen Lua Sourcecode laden können, der Interpreter diesen aber nicht parsen kann.</p>
<p>Außerdem muss das Lua Byte Code File kompatibel zu luac sein, und im Little-Endian Format vorliegen. Im Idealfall sollte folgender Header verwendet werden:</p>
<pre><code>00:    1B 4C 75 61 53 00 19 93
08:    0D 0A 1A 0A 04 08 04 08
10:    08 78 56 00 00 00 00 00
18:    00 00 00 00 00 00 28 77
20:    40</code></pre>
<p>Möglicherweise wird eine Konvertierungsfunktion implementiert, die Lua Byte Code von Big-Endian in Little-Endian umwandelt.</p>
<h2 id="detailierte-auflistung-der-bestandteile">Detailierte Auflistung der Bestandteile</h2>
<h3 id="byte-code-instruktionen">Byte Code Instruktionen</h3>
<p>siehe <a href="https://www.lua.org/source/5.3/lopcodes.h.html">hier</a><br />
bzw. <a href="https://github.com/dibyendumajumdar/ravi/blob/master/readthedocs/lua_bytecode_reference.rst">hier</a></p>
<h3 id="standard-library-funktionen">Standard Library Funktionen</h3>
<p><a href="https://www.lua.org/manual/5.3/manual.html#6">siehe auch</a></p>
<h4 id="basic-functions">Basic Functions</h4>
<p>Bis auf die folgenende Ausnahmen, sollen alle Basic Functions unterstützt werden:</p>
<ul>
<li><code>collectgarbage</code></li>
<li><code>dofile</code></li>
<li><code>load</code></li>
<li><code>loadfile</code></li>
<li><code>pcall</code></li>
<li><code>xpcall</code></li>
</ul>
<h4 id="string-manipulation">String Manipulation</h4>
<p>Auch hier ist geplant, bis auf einige Ausnahmen, alle Funktionen zu unterstützen.</p>
<p>Ausnahmen:</p>
<ul>
<li><code>string.dump</code></li>
<li><code>string.pack</code></li>
<li><code>string.packsize</code></li>
<li><code>string.unpack</code></li>
</ul>
<h4 id="utf-8-support">UTF-8 Support</h4>
<p>Die folgenden Methoden sollen alle unterstützt werden:</p>
<ul>
<li><code>utf8.char</code></li>
<li><code>utf8.charpattern</code></li>
<li><code>utf8.codes</code></li>
<li><code>utf8.codepoint</code></li>
<li><code>utf8.len</code></li>
<li><code>utf8.offset</code></li>
</ul>
<h4 id="table-manipulation">Table Manipulation</h4>
<p>Die folgenden Methoden sollen alle unterstützt werden:</p>
<ul>
<li><code>table.concat</code></li>
<li><code>table.insert</code></li>
<li><code>table.move</code></li>
<li><code>table.pack</code></li>
<li><code>table.remove</code></li>
<li><code>table.sort</code></li>
<li><code>table.unpack</code></li>
</ul>
<h4 id="mathematical-functions">Mathematical Functions</h4>
<p>Alle mathematischen Funktionen der Lua Standard Library sollen unterstützt werden.</p>
<h3 id="mogliche-erweiterungen">Mögliche Erweiterungen</h3>
<p>Möglicherweise werden auch alle oder Teile der IO Funktionen unterstützt werden.<br />
Auch die Funktionen <code>string.pack</code>, <code>string.packsize</code> und <code>string.unpack</code> werden vielleicht unterstützt.</p>
<h2 id="aufwandsabschatzungen">Aufwandsabschätzungen</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Komponente</th>
<th style="text-align: left;">Aufwand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Interpreter Grundgerüst</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Byte Code Instruktionen</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Standard Library</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h3 id="byte-code-instruktionen-1">Byte Code Instruktionen</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Gruppe</th>
<th style="text-align: left;">Instruktionen</th>
<th style="text-align: left;">Aufwand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Move/Load</td>
<td style="text-align: left;"><code>MOVE</code>, <code>LOADK</code>, <code>LOADKX</code>, <code>LOADBOOL</code>, <code>LOADNIL</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Up-Value/Table</td>
<td style="text-align: left;"><code>(GET/SET)UPVAL</code>, <code>(GET/SET)TABUP</code>, <code>(GET/SET)TABLE</code>, <code>NEWTABLE</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arithmetik</td>
<td style="text-align: left;"><code>ADD</code>, <code>SUB</code>, <code>MUL</code>, <code>DIV</code>, <code>IDIV</code>, <code>MOD</code>, <code>POW</code>, <code>UNM</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Bit Manipulation</td>
<td style="text-align: left;"><code>BAND</code>, <code>BOR</code>, <code>BXOR</code>, <code>SHL</code>, <code>SHR</code>, <code>BNOT</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Logik</td>
<td style="text-align: left;"><code>TEST</code>, <code>TESTSET</code>, <code>NOT</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Vergleiche</td>
<td style="text-align: left;"><code>EQ</code>, <code>LT</code>, <code>LE</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Schleifen</td>
<td style="text-align: left;"><code>FORLOOP</code>, <code>FORPREP</code>, <code>TFORLOOP</code>, <code>TFORCALL</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Funktionen</td>
<td style="text-align: left;"><code>CALL</code>, <code>TAILCALL</code>, <code>RETURN</code>, <code>CLOSURE</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andere</td>
<td style="text-align: left;"><code>JMP</code>, <code>VARARG</code>, <code>SETLIST</code>, <code>CONCAT</code>, <code>LEN</code>, <code>SELF</code>, <code>EXTRAARG</code></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h3 id="standard-library-funktionen-1">Standard Library Funktionen</h3>
<table style="width:17%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Gruppe</th>
<th style="text-align: left;">Funktionen</th>
<th style="text-align: left;">Aufwand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basis Funktionen</td>
<td style="text-align: left;"><code>assert</code>, <code>error</code>, <code>_G</code>, <code>getmetatable</code>, <code>ipairs</code>, <code>next</code>, <code>pairs</code>, <code>print</code>, <code>rawequal</code>, <code>rawget</code>, <code>rawlen</code>, <code>rawset</code>, <code>select</code>, <code>tonumber</code>, <code>tostring</code>, <code>type</code>, <code>_VERSION</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">String Manipulation</td>
<td style="text-align: left;"><code>string.byte</code>, <code>string.char</code>, <code>string.find</code>, <code>string.format</code>, <code>string.gmatch</code>, <code>string.gsub</code>, <code>string.len</code>, <code>string.lower</code>, <code>string. match</code>, <code>string.rep</code>, <code>string.reverse</code>, <code>string.sub</code>, <code>string.upper</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mathematik</td>
<td style="text-align: left;"><code>math.abs</code>, <code>math.acos</code>, <code>math.asin</code>, <code>math.atan</code>, <code>math.ceil</code>, <code>math.cos</code>, <code>math.deg</code>, <code>math.exp</code>, <code>math.floor</code>, <code>math.fmod</code>, <code>math.huge</code>, <code>math.log</code>, <code>math.max</code>, <code>math.maxinteger</code>, <code>math.min</code>, <code>math.mininteger</code>, <code>math.modf</code>, <code>math.pi</code>, <code>math.rad</code>, <code>math.random</code>, <code>math.randomseed</code>, <code>math.sin</code>, <code>math.sqrt</code>, <code>math.tan</code>, <code>math.tointeger</code>, <code>math.type</code>, <code>math.ult</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Table Manipulation</td>
<td style="text-align: left;"><code>table.concat</code>, <code>table.insert</code>, <code>table.move</code>, <code>table.pack</code>, <code>table.remove</code>, <code>table.pack</code>, <code>table.remove</code>, <code>table.sort</code>, <code>table.unpack</code></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">UTF-8 Support</td>
<td style="text-align: left;"><code>utf8.char</code>, <code>utf8.charpattern</code>, <code>utf8.codes</code>, <code>utf8.codepoint</code>, <code>utf8.len</code>, <code>utf8.offset</code></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="quellen">Quellen</h2>
<h3 id="beschreibung-des-lua-byte-code-file-format">Beschreibung des Lua Byte Code File Format</h3>
<ul>
<li><a href="http://luaforge.net/docman/83/98/ANoFrillsIntroToLua51VMInstructions.pdf" class="uri">http://luaforge.net/docman/83/98/ANoFrillsIntroToLua51VMInstructions.pdf</a> (nur teilweise)</li>
<li><a href="http://files.catwell.info/misc/mirror/lua-5.2-bytecode-vm-dirk-laurie/lua52vm.html" class="uri">http://files.catwell.info/misc/mirror/lua-5.2-bytecode-vm-dirk-laurie/lua52vm.html</a> (nur teilweise)</li>
<li><a href="https://www.lua.org/source/5.3/ldump.h.html" class="uri">https://www.lua.org/source/5.3/ldump.h.html</a></li>
<li><a href="https://www.lua.org/source/5.3/ldump.c.html" class="uri">https://www.lua.org/source/5.3/ldump.c.html</a></li>
<li><a href="https://www.lua.org/source/5.3/lundump.h.html" class="uri">https://www.lua.org/source/5.3/lundump.h.html</a></li>
<li><a href="https://www.lua.org/source/5.3/lundump.c.html" class="uri">https://www.lua.org/source/5.3/lundump.c.html</a></li>
</ul>
<h3 id="beschreibung-der-einzelnen-instruktionen">Beschreibung der einzelnen Instruktionen</h3>
<ul>
<li><a href="https://www.lua.org/source/5.3/lopcodes.h.html" class="uri">https://www.lua.org/source/5.3/lopcodes.h.html</a></li>
<li><a href="https://github.com/dibyendumajumdar/ravi/blob/master/readthedocs/lua_bytecode_reference.rst" class="uri">https://github.com/dibyendumajumdar/ravi/blob/master/readthedocs/lua_bytecode_reference.rst</a></li>
</ul>
